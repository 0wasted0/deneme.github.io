<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AREA - Modern Web Platform</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

  /* Genel stil ve arka plan animasyonu */
  * {
    box-sizing: border-box;
    margin: 0; padding: 0;
    font-family: 'Montserrat', sans-serif;
  }

  body {
    min-height: 100vh;
    background: linear-gradient(270deg, #1e3c72, #2a5298, #1e3c72);
    background-size: 600% 600%;
    animation: BackgroundShift 20s ease infinite;
    color: #eee;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 2rem;
    transition: background 0.5s ease;
  }

  @keyframes BackgroundShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  body.dark {
    background: linear-gradient(270deg, #222222, #111111, #222222);
  }

  #app-container {
    background: rgba(20, 20, 35, 0.9);
    border-radius: 24px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    width: 900px;
    max-width: 95vw;
    padding: 2rem 3rem;
    overflow: hidden;
    color: #eee;
    transition: background 0.5s ease, color 0.5s ease;
  }

  body.dark #app-container {
    background: #111;
    color: #ccc;
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.8rem;
  }

  header h1 {
    font-weight: 700;
    font-size: 2rem;
    letter-spacing: 2px;
    user-select: none;
  }

  #nav-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .nav-btn {
    background: linear-gradient(145deg, #4a90e2, #357ABD);
    border: none;
    padding: 0.7rem 1.5rem;
    border-radius: 16px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(69, 138, 255, 0.6);
    transition: all 0.3s ease;
    user-select: none;
    min-width: 90px;
    text-align: center;
  }

  .nav-btn:hover:not(.active) {
    background: linear-gradient(145deg, #357ABD, #4a90e2);
    box-shadow: 0 6px 20px rgba(69, 138, 255, 0.9);
    transform: translateY(-3px);
  }

  .nav-btn.active {
    background: linear-gradient(145deg, #2ecc71, #27ae60);
    box-shadow: 0 6px 20px rgba(39, 174, 96, 0.9);
    cursor: default;
  }

  main {
    border-radius: 24px;
    background: rgba(30, 30, 50, 0.85);
    padding: 2rem;
    box-shadow: inset 0 0 40px #1e1e2daa;
    min-height: 550px;
    overflow-y: auto;
    scroll-behavior: smooth;
    transition: background 0.5s ease, color 0.5s ease;
  }

  body.dark main {
    background: #222;
    color: #ccc;
  }

  button.btn {
    border-radius: 20px;
    padding: 0.8rem 1.8rem;
    font-weight: 700;
    letter-spacing: 0.7px;
    background: linear-gradient(135deg, #2980b9, #6dd5fa);
    border: none;
    color: white;
    box-shadow: 0 4px 12px #0f5b99;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  button.btn:hover {
    background: linear-gradient(135deg, #6dd5fa, #2980b9);
    box-shadow: 0 6px 20px #49aaff;
    transform: translateY(-4px);
  }

  input, textarea, select {
    border-radius: 16px;
    border: none;
    padding: 1rem 1.2rem;
    margin: 0.5rem 0 1rem 0;
    font-size: 1rem;
    background: #1f2533;
    color: #ddd;
    box-shadow: inset 2px 2px 6px #141a26,
                inset -2px -2px 6px #2a3344;
    transition: background 0.3s ease, color 0.3s ease;
    resize: vertical;
  }

  input:focus, textarea:focus, select:focus {
    outline: none;
    background: #2a3446;
    box-shadow: 0 0 8px 2px #4a90e2;
  }

  body.dark input, body.dark textarea, body.dark select {
    background: #2b2b3c;
    color: #ddd;
    box-shadow: inset 2px 2px 6px #1e1e2a,
                inset -2px -2px 6px #404059;
  }

  /* Scrollbar */
  main::-webkit-scrollbar {
    width: 10px;
  }
  main::-webkit-scrollbar-track {
    background: transparent;
  }
  main::-webkit-scrollbar-thumb {
    background: #4a90e2;
    border-radius: 20px;
  }

  /* Başarı, hata, bilgi mesajları */
  .message {
    padding: 0.8rem 1rem;
    margin: 1rem 0;
    border-radius: 12px;
    font-weight: 600;
    user-select: none;
  }
  .message.success {
    background: #27ae6011;
    color: #27ae60;
    border: 1.5px solid #27ae60;
  }
  .message.error {
    background: #e74c3c11;
    color: #e74c3c;
    border: 1.5px solid #e74c3c;
  }
  .message.info {
    background: #2980b911;
    color: #2980b9;
    border: 1.5px solid #2980b9;
  }

  /* Notlar ve hatırlatma kutuları */
  .note-box, .reminder-box {
    background: #33375f;
    padding: 1rem;
    border-radius: 16px;
    margin-bottom: 1rem;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    cursor: pointer;
    transition: background 0.3s ease;
    user-select: none;
  }
  .note-box:hover, .reminder-box:hover {
    background: #4a90e2;
    color: white;
  }
  body.dark .note-box, body.dark .reminder-box {
    background: #1e1e35;
  }
  body.dark .note-box:hover, body.dark .reminder-box:hover {
    background: #3a6fbf;
  }

  /* Header içindeki switchler */
  .switch-container {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .switch-label {
    cursor: pointer;
    user-select: none;
    font-weight: 600;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 26px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc;
    border-radius: 26px;
    transition: .4s;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 20px; width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    border-radius: 50%;
    transition: .4s;
  }
  input:checked + .slider {
    background-color: #2196f3;
  }
  input:checked + .slider:before {
    transform: translateX(22px);
  }

  /* Modal stil */
  .modal {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: #222;
    padding: 2rem;
    border-radius: 20px;
    width: 400px;
    max-width: 90vw;
    box-shadow: 0 0 25px #000a;
  }
  .modal-content h3 {
    margin-bottom: 1rem;
    font-weight: 700;
  }
  .modal-content button.close-btn {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 16px;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-weight: 700;
    float: right;
    transition: background 0.3s ease;
  }
  .modal-content button.close-btn:hover {
    background: #c0392b;
  }

  /* Responsive */
  @media (max-width: 600px) {
    #app-container {
      width: 100%;
      padding: 1rem 1.5rem;
    }
    .nav-btn {
      min-width: 70px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }
  }
</style>
</head>
<body>
  <div id="app-container">
    <header>
      <h1>AREA - Gelişmiş Web Platformu</h1>
      <div class="switch-container" style="gap:1rem; flex-wrap: wrap;">
        <label class="switch-label" for="toggle-darkmode">Koyu Mod</label>
        <label class="switch">
          <input type="checkbox" id="toggle-darkmode" />
          <span class="slider"></span>
        </label>
        <label class="switch-label" for="toggle-sounds">Sesler</label>
        <label class="switch">
          <input type="checkbox" id="toggle-sounds" />
          <span class="slider"></span>
        </label>
        <button id="btn-logout" style="margin-left:1rem; border-radius: 16px; padding:0.5rem 1rem; background:#e74c3c; font-weight:700; color:#fff; border:none; cursor:pointer; user-select:none; display:none;">Çıkış Yap</button>
      </div>
    </header>

    <nav id="nav-buttons" style="margin-bottom: 1rem;">
      <!-- Butonlar JS ile eklenecek -->
    </nav>

    <main id="main-content">
      <!-- Sayfa içeriği JS ile yüklenecek -->
    </main>
  </div>

  <!-- Not / Hatırlatma Modal -->
  <div class="modal" id="modal-note">
    <div class="modal-content">
      <button class="close-btn" id="close-note-modal">&times;</button>
      <h3>Yeni Not / Hatırlatma Oluştur</h3>
      <form id="form-note">
        <label>Başlık:</label>
        <input type="text" id="note-title" required maxlength="50" autocomplete="off" />
        <label>İçerik:</label>
        <textarea id="note-content" rows="4" required></textarea>
        <label>Tip:</label>
        <select id="note-type">
          <option value="note">Not</option>
          <option value="reminder">Hatırlatma</option>
        </select>
        <div id="reminder-datetime-container" style="display:none;">
          <label>Tarih & Saat:</label>
          <input type="datetime-local" id="reminder-datetime" />
        </div>
        <button type="submit" class="btn" style="width:100%; margin-top:1rem;">Kaydet</button>
      </form>
    </div>
  </div>

<script>
(() => {
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => document.querySelectorAll(s);

  // Ses efektleri için basit click sesi
  const clickSound = new Audio('https://freesound.org/data/previews/522/522423_6959021-lq.mp3');
  clickSound.volume = 0.25;

  // Durum objesi
  const state = {
    users: [],
    currentUser: null,
    currentSection: null,
    soundsEnabled: true
  };

  // LocalStorage key
  const STORAGE_KEY = 'area_platform_users';

  // Şifre hash fonksiyonu (basit SHA-256)
  async function hashPassword(pass) {
    const encoder = new TextEncoder();
    const data = encoder.encode(pass);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  // Kullanıcıları yükle
  function loadUsers() {
    const data = localStorage.getItem(STORAGE_KEY);
    if(data) state.users = JSON.parse(data);
    else state.users = [];
  }

  // Kullanıcıları kaydet
  function saveUsers() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state.users));
  }

  // Mevcut kullanıcıyı kaydet
  function saveCurrentUser() {
    const index = state.users.findIndex(u => u.username === state.currentUser.username);
    if(index !== -1) {
      state.users[index] = state.currentUser;
      saveUsers();
    }
  }

  // Ses çalma
  function playClickSound() {
    if(state.soundsEnabled) {
      clickSound.currentTime = 0;
      clickSound.play();
    }
  }

  // Toast mesaj gösterme (kısa bilgi)
  function showToast(text, type='info') {
    const toast = document.createElement('div');
    toast.textContent = text;
    toast.className = `message ${type}`;
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.zIndex = 10000;
    toast.style.opacity = '0';
    toast.style.transition = 'opacity 0.4s ease';
    document.body.appendChild(toast);
    setTimeout(() => toast.style.opacity = '1', 10);
    setTimeout(() => {
      toast.style.opacity = '0';
      setTimeout(() => toast.remove(), 400);
    }, 3500);
  }

  // DOM elementleri
  const navButtons = $('#nav-buttons');
  const mainContent = $('#main-content');
  const darkModeToggle = $('#toggle-darkmode');
  const soundsToggle = $('#toggle-sounds');
  const logoutBtn = $('#btn-logout');

  // Bölümler (sayfalar)
  const SECTIONS = [
    { id:'login', label:'Giriş Yap', render: renderLogin },
    { id:'register', label:'Kayıt Ol', render: renderRegister },
    { id:'dashboard', label:'Ana Sayfa', render: renderDashboard },
    { id:'notes', label:'Notlar', render: renderNotes },
    { id:'settings', label:'Ayarlar', render: renderSettings },
    { id:'games', label:'Oyunlar', render: renderGames },
  ];

  // Aktif bölümü ayarla ve render et
  function setSection(id) {
    state.currentSection = id;
    render();
    updateNav();
  }

  // Nav butonlarını renderla
  function updateNav() {
    navButtons.innerHTML = '';
    if(!state.currentUser) {
      // Giriş ve kayıt arasında toggle
      if(state.currentSection === 'login') {
        navButtons.innerHTML = `<button class="nav-btn active">Giriş Yap</button>
        <button class="nav-btn" onclick="setSection('register')">Kayıt Ol</button>`;
      } else {
        navButtons.innerHTML = `<button class="nav-btn" onclick="setSection('login')">Giriş Yap</button>
        <button class="nav-btn active">Kayıt Ol</button>`;
      }
      logoutBtn.style.display = 'none';
    } else {
      // Kullanıcı giriş yaptıysa
      SECTIONS.forEach(s => {
        if(s.id === 'login' || s.id === 'register') return;
        const activeClass = s.id === state.currentSection ? 'active' : '';
        navButtons.innerHTML += `<button class="nav-btn ${activeClass}" onclick="setSection('${s.id}')">${s.label}</button>`;
      });
      logoutBtn.style.display = 'inline-block';
    }
  }

  // Render fonksiyonu - aktif bölüme göre içerik üretir
  function render() {
    mainContent.innerHTML = '';
    if(!state.currentSection) setSection(state.currentUser ? 'dashboard' : 'login');
    else {
      const sec = SECTIONS.find(s => s.id === state.currentSection);
      if(sec && sec.render) sec.render();
    }
  }

  // -------------------- Bölüm render fonksiyonları -----------------------

  // Giriş yapma sayfası
  function renderLogin() {
    mainContent.innerHTML = `
      <h2>Giriş Yap</h2>
      <form id="form-login">
        <label>Kullanıcı Adı:</label>
        <input type="text" id="login-username" required autocomplete="off" />
        <label>Şifre:</label>
        <input type="password" id="login-password" required autocomplete="off" />
        <button type="submit" class="btn">Giriş</button>
      </form>
      <p style="margin-top:1rem;">Hesabınız yok mu? <button class="btn" style="padding:0.3rem 1rem;" onclick="setSection('register')">Kayıt Ol</button></p>
      <div id="login-message"></div>
    `;

    $('#form-login').addEventListener('submit', async e => {
      e.preventDefault();
      playClickSound();
      const username = $('#login-username').value.trim();
      const password = $('#login-password').value;
      const hash = await hashPassword(password);
      const user = state.users.find(u => u.username === username);
      if(!user) {
        showToast('Kullanıcı bulunamadı.', 'error');
        return;
      }
      if(user.password !== hash) {
        showToast('Şifre yanlış.', 'error');
        return;
      }
      state.currentUser = JSON.parse(JSON.stringify(user));
      showToast('Başarıyla giriş yapıldı!', 'success');
      saveCurrentUser();
      setSection('dashboard');
      render();
      updateLogoutButton();
    });
  }

  // Kayıt olma sayfası
  function renderRegister() {
    mainContent.innerHTML = `
      <h2>Kayıt Ol</h2>
      <form id="form-register">
        <label>Kullanıcı Adı:</label>
        <input type="text" id="register-username" required autocomplete="off" />
        <label>Şifre:</label>
        <input type="password" id="register-password" required autocomplete="off" />
        <label>Şifre Tekrar:</label>
        <input type="password" id="register-password2" required autocomplete="off" />
        <button type="submit" class="btn">Kayıt Ol</button>
      </form>
      <p style="margin-top:1rem;">Zaten hesabınız var mı? <button class="btn" style="padding:0.3rem 1rem;" onclick="setSection('login')">Giriş Yap</button></p>
      <div id="register-message"></div>
    `;

    $('#form-register').addEventListener('submit', async e => {
      e.preventDefault();
      playClickSound();
      const username = $('#register-username').value.trim();
      const password = $('#register-password').value;
      const password2 = $('#register-password2').value;

      if(username.length < 3) {
        showToast('Kullanıcı adı en az 3 karakter olmalı.', 'error');
        return;
      }
      if(password.length < 6) {
        showToast('Şifre en az 6 karakter olmalı.', 'error');
        return;
      }
      if(password !== password2) {
        showToast('Şifreler uyuşmuyor.', 'error');
        return;
      }
      if(state.users.find(u => u.username === username)) {
        showToast('Bu kullanıcı adı zaten alınmış.', 'error');
        return;
      }

      const hash = await hashPassword(password);
      const newUser = {
        username,
        password: hash,
        notes: [],
        reminders: [],
        darkMode: false,
        sounds: true
      };
      state.users.push(newUser);
      saveUsers();
      showToast('Kayıt başarılı! Giriş yapabilirsiniz.', 'success');
      setSection('login');
      render();
    });
  }

  // Ana sayfa
  function renderDashboard() {
    mainContent.innerHTML = `
      <h2>Hoşgeldin, ${state.currentUser.username}!</h2>
      <p>Buradan notlarını yönetebilir, oyunlara geçebilir veya ayarlarını değiştirebilirsin.</p>
      <div style="margin-top:2rem;">
        <button class="btn" onclick="setSection('notes')">Notlar & Hatırlatmalar</button>
        <button class="btn" style="margin-left:1rem;" onclick="setSection('games')">Oyunlar</button>
        <button class="btn" style="margin-left:1rem;" onclick="setSection('settings')">Ayarlar</button>
      </div>
    `;
  }

  // Notlar ve hatırlatmalar sayfası
  function renderNotes() {
    const notes = state.currentUser.notes || [];
    const reminders = state.currentUser.reminders || [];

    mainContent.innerHTML = `
      <h2>Notlar & Hatırlatmalar</h2>
      <button class="btn" id="btn-new-note">Yeni Not/Hatırlatma Oluştur</button>
      <div style="margin-top: 1rem;">
        <h3>Notlar</h3>
        <div id="notes-list">
          ${notes.length === 0 ? '<p>Henüz not yok.</p>' : notes.map((n, i) => 
            `<div class="note-box" data-index="${i}" data-type="note"><strong>${escapeHtml(n.title)}</strong><br><small>${escapeHtml(n.content)}</small></div>`).join('')}
        </div>
        <h3 style="margin-top:2rem;">Hatırlatmalar</h3>
        <div id="reminders-list">
          ${reminders.length === 0 ? '<p>Henüz hatırlatma yok.</p>' : reminders.map((r, i) => {
            const dt = new Date(r.datetime);
            return `<div class="reminder-box" data-index="${i}" data-type="reminder"><strong>${escapeHtml(r.title)}</strong><br><small>${dt.toLocaleString()}</small><br><small>${escapeHtml(r.content)}</small></div>`;
          }).join('')}
        </div>
      </div>
    `;

    $('#btn-new-note').onclick = () => {
      openNoteModal();
      playClickSound();
    };

    // Not kutularına tıklayınca detay göster
    $$('#notes-list .note-box, #reminders-list .reminder-box').forEach(el => {
      el.onclick = () => {
        const type = el.dataset.type;
        const idx = +el.dataset.index;
        let item = null;
        if(type === 'note') item = state.currentUser.notes[idx];
        else item = state.currentUser.reminders[idx];
        if(item) {
          alert(`Başlık: ${item.title}\n\nİçerik: ${item.content}${type === 'reminder' ? `\n\nTarih: ${new Date(item.datetime).toLocaleString()}` : ''}`);
          playClickSound();
        }
      };
    });
  }

  // Ayarlar sayfası
  function renderSettings() {
    mainContent.innerHTML = `
      <h2>Ayarlar</h2>
      <form id="form-settings">
        <label>Mevcut Şifre:</label>
        <input type="password" id="old-password" required autocomplete="off" />
        <label>Yeni Şifre:</label>
        <input type="password" id="new-password" required autocomplete="off" />
        <label>Yeni Şifre Tekrar:</label>
        <input type="password" id="new-password2" required autocomplete="off" />
        <button type="submit" class="btn">Şifreyi Değiştir</button>
      </form>
      <div style="margin-top:2rem;">
        <label>Koyu Mod</label>
        <input type="checkbox" id="settings-darkmode" />
      </div>
      <div style="margin-top:1rem;">
        <label>Sesleri Aç/Kapat</label>
        <input type="checkbox" id="settings-sounds" />
      </div>
    `;

    $('#settings-darkmode').checked = state.currentUser.darkMode;
    $('#settings-sounds').checked = state.currentUser.sounds;

    $('#form-settings').addEventListener('submit', async e => {
      e.preventDefault();
      playClickSound();
      const oldPass = $('#old-password').value;
      const newPass = $('#new-password').value;
      const newPass2 = $('#new-password2').value;

      if(newPass !== newPass2) {
        showToast('Yeni şifreler uyuşmuyor.', 'error');
        return;
      }
      if(newPass.length < 6) {
        showToast('Yeni şifre en az 6 karakter olmalı.', 'error');
        return;
      }

      const oldHash = await hashPassword(oldPass);
      if(oldHash !== state.currentUser.password) {
        showToast('Mevcut şifre yanlış.', 'error');
        return;
      }

      state.currentUser.password = await hashPassword(newPass);
      saveCurrentUser();
      showToast('Şifre başarıyla değiştirildi!', 'success');
      $('#form-settings').reset();
    });

    $('#settings-darkmode').addEventListener('change', e => {
      state.currentUser.darkMode = e.target.checked;
      applyDarkMode(state.currentUser.darkMode);
      saveCurrentUser();
    });

    $('#settings-sounds').addEventListener('change', e => {
      state.currentUser.sounds = e.target.checked;
      state.soundsEnabled = e.target.checked;
      soundsToggle.checked = e.target.checked;
      saveCurrentUser();
    });
  }

  // Oyunlar sayfası
  function renderGames() {
    mainContent.innerHTML = `
      <h2>Oyunlar</h2>
      <p>Oyunu oynayabilmek için tarayıcı izinlerine dikkat edin.</p>
      <div style="display:flex; flex-wrap: wrap; gap: 1rem; margin-top:1rem;">
        <iframe src="https://playsnake.org" title="Yılan Oyunu" style="flex:1 1 300px; height:400px; border-radius: 20px; border:none; box-shadow: 0 6px 20px rgba(0,0,0,0.5);"></iframe>
        <iframe src="https://play2048.co" title="2048 Oyunu" style="flex:1 1 300px; height:400px; border-radius: 20px; border:none; box-shadow: 0 6px 20px rgba(0,0,0,0.5);"></iframe>
        <iframe src="https://sudoku.com" title="Sudoku" style="flex:1 1 300px; height:400px; border-radius: 20px; border:none; box-shadow: 0 6px 20px rgba(0,0,0,0.5);"></iframe>
      </div>
    `;
  }

  // -------- Not / Hatırlatma Modal İşlemleri -----------------
  const modalNote = $('#modal-note');
  const closeNoteBtn = $('#close-note-modal');
  const formNote = $('#form-note');
  const noteTypeSelect = $('#note-type');
  const reminderDatetimeContainer = $('#reminder-datetime-container');

  function openNoteModal() {
    modalNote.classList.add('active');
    formNote.reset();
    reminderDatetimeContainer.style.display = 'none';
  }
  function closeNoteModal() {
    modalNote.classList.remove('active');
  }

  closeNoteBtn.onclick = () => {
    playClickSound();
    closeNoteModal();
  };

  noteTypeSelect.onchange = () => {
    if(noteTypeSelect.value === 'reminder') {
      reminderDatetimeContainer.style.display = 'block';
      $('#reminder-datetime').setAttribute('required', 'required');
    } else {
      reminderDatetimeContainer.style.display = 'none';
      $('#reminder-datetime').removeAttribute('required');
    }
  };

  formNote.onsubmit = (e) => {
    e.preventDefault();
    playClickSound();
    const title = $('#note-title').value.trim();
    const content = $('#note-content').value.trim();
    const type = noteTypeSelect.value;
    if(!title || !content) {
      showToast('Başlık ve içerik zorunlu.', 'error');
      return;
    }
    if(type === 'reminder') {
      const dt = $('#reminder-datetime').value;
      if(!dt || new Date(dt) < new Date()) {
        showToast('Geçerli bir tarih ve saat giriniz.', 'error');
        return;
      }
      state.currentUser.reminders.push({title, content, datetime: dt});
      showToast('Hatırlatma oluşturuldu!', 'success');
    } else {
      state.currentUser.notes.push({title, content});
      showToast('Not oluşturuldu!', 'success');
    }
    saveCurrentUser();
    closeNoteModal();
    setSection('notes');
  };

  // ----------------- Dark Mode uygulama -----------------------
  function applyDarkMode(enabled) {
    if(enabled) {
      document.body.classList.add('dark');
      darkModeToggle.checked = true;
    } else {
      document.body.classList.remove('dark');
      darkModeToggle.checked = false;
    }
  }

  darkModeToggle.addEventListener('change', e => {
    state.currentUser.darkMode = e.target.checked;
    applyDarkMode(e.target.checked);
    saveCurrentUser();
  });

  // Ses ayarları toggle
  soundsToggle.addEventListener('change', e => {
    state.soundsEnabled = e.target.checked;
    if(state.currentUser) {
      state.currentUser.sounds = e.target.checked;
      saveCurrentUser();
    }
  });

  // ----------------- Logout işlemi ------------------------
  logoutBtn.onclick = () => {
    playClickSound();
    state.currentUser = null;
    setSection('login');
    updateLogoutButton();
  };

  function updateLogoutButton() {
    logoutBtn.style.display = state.currentUser ? 'inline-block' : 'none';
  }

  // ---------- Bildirim izni ve kontrol -------------------
  function requestNotificationPermission() {
    if (!("Notification" in window)) {
      console.log("Tarayıcı bildirimleri desteklemiyor.");
      return;
    }
    if(Notification.permission === "default") {
      Notification.requestPermission().then(permission => {
        if(permission === "granted") {
          showToast("Bildirim izni verildi.", "success");
        } else {
          showToast("Bildirim izni reddedildi.", "error");
        }
      });
    }
  }

  // Hatırlatmaları kontrol et ve göster
  function checkReminders() {
    if(!state.currentUser) return;
    if(Notification.permission !== "granted") return;

    const now = new Date();
    state.currentUser.reminders.forEach((reminder, idx) => {
      const dt = new Date(reminder.datetime);
      // Eğer şu an veya geçtiyse ve daha önce gösterilmediyse göster
      if(dt <= now && !reminder.shown) {
        const notif = new Notification(`Hatırlatma: ${reminder.title}`, {
          body: reminder.content,
          icon: 'https://cdn-icons-png.flaticon.com/512/1827/1827392.png'
        });
        reminder.shown = true;
        saveCurrentUser();
        // Ses de çal
        playClickSound();
      }
    });
  }

  setInterval(checkReminders, 15 * 1000); // Her 15 saniyede bir kontrol

  // Güvenli text gösterimi için escape
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, m => ({
      '&':'&amp;',
      '<':'&lt;',
      '>':'&gt;',
      '"':'&quot;',
      "'":'&#39;'
    })[m]);
  }

  // Sayfa yüklendiğinde
  window.onload = () => {
    loadUsers();

    // Varsayılan darkmode ve sound seçenekleri
    if(state.users.length > 0) {
      // Eğer localstorage varsa ilk kullanıcıyı seç
      state.currentUser = state.users[0];
      applyDarkMode(state.currentUser.darkMode);
      soundsToggle.checked = state.currentUser.sounds;
      state.soundsEnabled = state.currentUser.sounds;
    } else {
      applyDarkMode(false);
      soundsToggle.checked = true;
      state.soundsEnabled = true;
    }

    updateNav();
    setSection(state.currentUser ? 'dashboard' : 'login');
    updateLogoutButton();

    // Bildirim izni iste
    requestNotificationPermission();
  };

  // setSection global erişim için
  window.setSection = (id) => {
    playClickSound();
    setSection(id);
  };
})();
</script>
</body>
</html>


